/* Chart Container */
.chart-container {
    width: 100%;
    height: 400px; /* Give space for the chart */
    margin-bottom: 30px;
    display: flex;
    justify-content: center;
    align-items: center;
}

/* Chart Styling */
#trendChart {
    width: 100%;
    height: 100%;
    border-radius: 8px; /* Optional rounded corners for the chart */
    border: 1px solid #ddd; /* Optional light border for visual separation */
}

/* Back Button Styling */
.back-btn {
    background-color: #007bff;
    color: white;
    padding: 12px 24px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 1.2rem;
    transition: background-color 0.3s ease;
    display: block;
    margin: 20px auto 0; /* Centering the button horizontally */
}

.back-btn:hover {
    background-color: #0056b3;
}

.back-btn:focus {
    outline: none; /* Remove the default outline when focused */
}












document.addEventListener("DOMContentLoaded", function () {
    // Replace 'apac' with the region you want to fetch data for
    const region = 'apac'; // You can replace this dynamically based on user input if needed
    fetch(`http://localhost:80/api/region/trend/details/${region}`)
        .then(response => response.json())
        .then(data => {
            if (data && data.devices) {
                displayTrendChart(data.devices);
            } else {
                console.error("No devices data available.");
            }
        })
        .catch(error => console.error("Error fetching trend data:", error));
});

function displayTrendChart(devices) {
    const labels = devices.map(device => device.ip);
    const uptimeData = devices.map(device => convertToMinutes(device.daily.uptime));
    const downtimeData = devices.map(device => convertToMinutes(device.daily.downtimeDuration));

    const ctx = document.getElementById("trendChart").getContext("2d");
    new Chart(ctx, {
        type: "bar",
        data: {
            labels: labels,
            datasets: [
                {
                    label: "Uptime (minutes)",
                    data: uptimeData,
                    backgroundColor: "green",
                },
                {
                    label: "Downtime (minutes)",
                    data: downtimeData,
                    backgroundColor: "red",
                }
            ]
        },
        options: {
            responsive: true,
            scales: {
                y: { beginAtZero: true }
            }
        }
    });
}

function convertToMinutes(timeString) {
    const parts = timeString.split(" ");
    let totalMinutes = 0;
    parts.forEach(part => {
        if (part.includes("d")) totalMinutes += parseInt(part) * 1440; // Convert days to minutes (1 day = 1440 minutes)
        if (part.includes("h")) totalMinutes += parseInt(part) * 60;  // Convert hours to minutes (1 hour = 60 minutes)
        if (part.includes("m")) totalMinutes += parseInt(part); // Minutes
    });
    return totalMinutes;
}




<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trend Analysis</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Device Trend Analysis</h1>
        <canvas id="trendChart"></canvas>
        <button onclick="window.location.href='index.html'">Back to Dashboard</button>
    </div>

    <script src="trend.js"></script> <!-- JavaScript to fetch and display trends -->
</body>
</html>



app.js


app.get("/api/region/trend/details/:region", (req, res) => {
  try {
    const region = req.params.region.toLowerCase();
    console.log(`Fetching details for region: ${region}`);

    const { day, week, month } = getDateKeys();

    let deviceDetails = [];

    Object.keys(uptimeDowntimeStats).forEach(ip => {
      const device = allData.cameras.find(d => d.ip_address === ip) ||
                     allData.archivers.find(d => d.ip_address === ip) ||
                     allData.controllers.find(d => d.ip_address === ip) ||
                     allData.servers.find(d => d.ip_address === ip);

      if (device && device.location?.toLowerCase() === region) {
        const stats = uptimeDowntimeStats[ip];

        deviceDetails.push({
          ip,
          name: device.name,
          type: device.type || "Unknown", // Device type (Camera, Server, etc.)
          location: device.location || "Unknown", // Device location
          status: deviceStatus[ip] || "Unknown",
          daily: {
            uptime: formatDuration(stats.daily[day]?.uptime),
            downtime: formatDuration(stats.daily[day]?.downtime),
            downtimeDuration: formatDuration(stats.daily[day]?.downtimeDuration)
          },
          weekly: {
            uptime: formatDuration(stats.weekly[week]?.uptime),
            downtime: formatDuration(stats.weekly[week]?.downtime),
            downtimeDuration: formatDuration(stats.weekly[week]?.downtimeDuration)
          },
          monthly: {
            uptime: formatDuration(stats.monthly[month]?.uptime),
            downtime: formatDuration(stats.monthly[month]?.downtime),
            downtimeDuration: formatDuration(stats.monthly[month]?.downtimeDuration)
          }
        });
      }
    });

    if (deviceDetails.length === 0) {
      return res.status(404).json({ message: `No devices found for region: ${region}` });
    }

    return res.status(200).json({ region, devices: deviceDetails });

  } catch (error) {
    console.error("Error in details API:", error);
    return res.status(500).json({ message: "Something went wrong!", error: error.message });
  }
});

// Helper function to format time duration
const formatDuration = (seconds) => {
  if (seconds === undefined) return "0d 0h 0m 0s";

  const d = Math.floor(seconds / 86400); // 1 day = 86400 seconds
  const h = Math.floor((seconds % 86400) / 3600); // 1 hour = 3600 seconds
  const m = Math.floor((seconds % 3600) / 60); // 1 minute = 60 seconds
  const s = Math.floor(seconds % 60); 

  return `${d}d ${h}h ${m}m ${s}s`;
};



Api-http://localhost/api/region/trend/details/apac (apac /emea/laca namer/global)


api responce- 

{
  "region": "apac",
  "devices": [
    {
      "ip": "10.199.10.20",
      "type": "Unknown",
      "location": "APAC",
      "status": "Online",
      "daily": {
        "uptime": "0d 1h 7m 0s",
        "downtime": "0d 0h 0m 0s",
        "downtimeDuration": "0d 0h 0m 0s"
      },
      "weekly": {
        "uptime": "0d 1h 7m 0s",
        "downtime": "0d 0h 0m 0s",
        "downtimeDuration": "0d 0h 0m 0s"
      },
      "monthly": {
        "uptime": "0d 1h 7m 0s",
        "downtime": "0d 0h 0m 0s",
        "downtimeDuration": "0d 0h 0m 0s"
      }
    },



trend.js

document.addEventListener("DOMContentLoaded", function () {
    fetch("http://localhost:80/api/region/trend/details/regions")
        .then(response => response.json())
        .then(data => {
            if (data && data.devices) {
                displayTrendChart(data.devices);
            } else {
                console.error("No devices data available.");
            }
        })
        .catch(error => console.error("Error fetching trend data:", error));
});

function displayTrendChart(devices) {
    const labels = devices.map(device => device.ip);
    const uptimeData = devices.map(device => convertToMinutes(device.uptime));
    const downtimeData = devices.map(device => convertToMinutes(device.downtimeDuration));

    const ctx = document.getElementById("trendChart").getContext("2d");
    new Chart(ctx, {
        type: "bar",
        data: {
            labels: labels,
            datasets: [
                {
                    label: "Uptime (minutes)",
                    data: uptimeData,
                    backgroundColor: "green",
                },
                {
                    label: "Downtime (minutes)",
                    data: downtimeData,
                    backgroundColor: "red",
                }
            ]
        },
        options: {
            responsive: true,
            scales: {
                y: { beginAtZero: true }
            }
        }
    });
}

function convertToMinutes(timeString) {
    const parts = timeString.split(" ");
    let totalMinutes = 0;
    parts.forEach(part => {
        if (part.includes("h")) totalMinutes += parseInt(part) * 60;
        if (part.includes("m")) totalMinutes += parseInt(part);
    });
    return totalMinutes;
}



trend.html

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trend Analysis</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Device Trend Analysis</h1>
        <canvas id="trendChart"></canvas>
        <button onclick="window.location.href='index.html'">Back to Dashboard</button>
    </div>

    <script src="trend.js"></script> <!-- JavaScript to fetch and display trends -->
</body>
</html>



