const calculateTrend = (devices, period) => {
    const allDevices = [...devices.cameras, ...devices.archivers, ...devices.controllers, ...devices.servers];

    return allDevices.map(device => {
        // Ensure history is defined before calculating uptime/downtime
        if (!device.history || device.history.length === 0) {
            console.log(`No history for device ${device.device_name}`);
            return {
                device_name: device.device_name || "Unknown",
                ip_address: device.ip_address,
                uptime: 0,
                downtime: 0,
                downtimeDuration: 0
            };
        }

        const { uptime, downtime, downtimeDuration } = computeDeviceStats(device.history);
        return {
            device_name: device.device_name || "Unknown",
            ip_address: device.ip_address,
            uptime,
            downtime,
            downtimeDuration
        };
    });
};







const computeDeviceStats = (history) => {
    if (!Array.isArray(history) || history.length === 0) {
        console.log("No history data found for device");
        return { uptime: 0, downtime: 0, downtimeDuration: 0 };
    }

    let uptime = 0, downtime = 0, downtimeDuration = 0;
    let lastStatus = null;
    let lastTimestamp = null;

    history.forEach((log, index) => {
        let currentTime = new Date(log.timestamp).getTime();

        if (index > 0 && lastTimestamp) {
            let timeDiff = (currentTime - lastTimestamp) / 60000; // Convert ms to minutes

            if (lastStatus === "online") {
                uptime += timeDiff;
            } else if (lastStatus === "offline") {
                downtime += timeDiff;
                downtimeDuration++;
            }
        }

        lastStatus = log.status;
        lastTimestamp = currentTime;
    });

    return { uptime: Math.round(uptime), downtime: Math.round(downtime), downtimeDuration };
};











Api - http://localhost/api/regions/trend/details/emea

responce -
{"region":"emea","trends":{"region":"emea","trends":{"daily":[{"device_name":"Unknown","ip_address":"10.128.203.3","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.128.218.70","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.131.106.133","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.138.33.9","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.138.161.4","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.136.63.236","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.128.194.70","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.128.203.5","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.128.203.4","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.130.36.56","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.128.194.102","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.128.218.107","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.131.106.134","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.138.161.10","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.138.33.7","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.138.33.4","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.138.33.5","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.138.33.6","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.138.161.11","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.138.161.6","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.138.161.7","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.138.161.13","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.138.161.8","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.138.161.14","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.129.83.12","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.128.144.124","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.128.178.110","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.130.36.56","uptime":0,"downtime":0,"downtimeDuration":0}],"weekly":[{"device_name":"Unknown","ip_address":"10.128.203.3","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.128.218.70","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.131.106.133","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.138.33.9","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.138.161.4","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.136.63.236","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.128.194.70","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.128.203.5","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.128.203.4","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.130.36.56","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.128.194.102","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.128.218.107","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.131.106.134","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.138.161.10","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.138.33.7","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.138.33.4","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.138.33.5","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.138.33.6","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.138.161.11","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.138.161.6","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.138.161.7","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.138.161.13","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.138.161.8","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.138.161.14","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.129.83.12","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.128.144.124","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.128.178.110","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.130.36.56","uptime":0,"downtime":0,"downtimeDuration":0}],"monthly":[{"device_name":"Unknown","ip_address":"10.128.203.3","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.128.218.70","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.131.106.133","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.138.33.9","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.138.161.4","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.136.63.236","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.128.194.70","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.128.203.5","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.128.203.4","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.130.36.56","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.128.194.102","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.128.218.107","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.131.106.134","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.138.161.10","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.138.33.7","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.138.33.4","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.138.33.5","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.138.33.6","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.138.161.11","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.138.161.6","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.138.161.7","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.138.161.13","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.138.161.8","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.138.161.14","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.129.83.12","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.128.144.124","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.128.178.110","uptime":0,"downtime":0,"downtimeDuration":0},{"device_name":"Unknown","ip_address":"10.130.36.56","uptime":0,"downtime":0,"downtimeDuration":0}]},"devices":{"cameras":[],"archivers":[{"status":"Online","ip_address":"10.128.203.3","location":"EMEA"},{"status":"Online","ip_address":"10.128.218.70","location":"EMEA"},{"status":"Online","ip_address":"10.131.106.133","location":"EMEA"},{"status":"Online","ip_address":"10.138.33.9","location":"EMEA"},{"status":"Online","ip_address":"10.138.161.4","location":"EMEA"},{"status":"Online","ip_address":"10.136.63.236","location":"EMEA"},{"status":"Online","ip_address":"10.128.194.70","location":"EMEA"}],"controllers":[{"status":"Online","ip_address":"10.128.203.5","location":"EMEA"},{"status":"Online","ip_address":"10.128.203.4","location":"EMEA"},{"status":"Online","ip_address":"10.130.36.56","location":"EMEA"},{"status":"Online","ip_address":"10.128.194.102","location":"EMEA"},{"status":"Online","ip_address":"10.128.218.107","location":"EMEA"},{"status":"Online","ip_address":"10.131.106.134","location":"EMEA"},{"status":"Online","ip_address":"10.138.161.10","location":"EMEA"},{"status":"Online","ip_address":"10.138.33.7","location":"EMEA"},{"status":"Online","ip_address":"10.138.33.4","location":"EMEA"},{"status":"Online","ip_address":"10.138.33.5","location":"EMEA"},{"status":"Online","ip_address":"10.138.33.6","location":"EMEA"},{"status":"Online","ip_address":"10.138.161.11","location":"EMEA"},{"status":"Online","ip_address":"10.138.161.6","location":"EMEA"},{"status":"Online","ip_address":"10.138.161.7","location":"EMEA"},{"status":"Online","ip_address":"10.138.161.13","location":"EMEA"},{"status":"Online","ip_address":"10.138.161.8","location":"EMEA"},{"status":"Online","ip_address":"10.138.161.14","location":"EMEA"},{"status":"Online","ip_address":"10.129.83.12","location":"EMEA"},{"status":"Online","ip_address":"10.128.144.124","location":"EMEA"},{"status":"Online","ip_address":"10.128.178.110","location":"EMEA"}],"servers":[{"status":"Online","ip_address":"10.130.36.56","location":"EMEA"}]}}}


in this responce device uptime & Downtime in not increasing.
