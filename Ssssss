function updateDowntimeCount(deviceIp, history) {
    let downtimeEntries = history.filter(entry => entry.status === "Offline");

    // Filter out downtimes that are less than or equal to 5 minutes, except for servers
    let filteredDowntimeEntries = downtimeEntries.filter((entry, index, arr) => {
        let deviceType = getDeviceType(deviceIp);  // Get device type (e.g., "SERVER")
        if (deviceType === "SERVER") return true; // Always count downtime for servers
        if (index === 0) return true; // Always count the first offline entry
        
        let previousEntry = arr[index - 1];
        let duration = (new Date(entry.timestamp) - new Date(previousEntry.timestamp)) / 1000; // Duration in seconds
        return duration > 300; // Only count if downtime is greater than 5 minutes (300 seconds)
    });

    let downtimeCount = filteredDowntimeEntries.length; // Count valid offline occurrences

    // Update UI with correct downtime count
    let downtimeElement = document.getElementById(`downtime-count-${deviceIp}`);
    if (downtimeElement) {
        downtimeElement.innerText = downtimeCount;
    }

    // Fix: Ensure remarks also reflect downtime count properly
    let remarkElement = document.getElementById(`remark-${deviceIp}`);
    if (remarkElement) {
        if (downtimeCount === 0) {
            remarkElement.innerText = "Device is Online.";
        } else if (downtimeCount >= 3) {
            remarkElement.innerText = `Device is Online, but it had ${downtimeCount} offline occurrences. Needs repair!`;
        } else {
            remarkElement.innerText = `Device is Online, but it had ${downtimeCount} offline occurrences.`;
        }
    }
}

// Function to get the device type based on IP (or any other mechanism you use)
function getDeviceType(deviceIp) {
    // This is a placeholder. You may have to fetch the device type from your database or device data.
    // For now, assume you have a way to identify the device type.
    return "SERVER"; // Or "CAMERA", "ARCHIVER", "CONTROLLER", etc.
}
