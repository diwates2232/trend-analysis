function pingAllDevices(details, regionName) {
    let statusChanged = false; // Track if any status changed

    for (const [key, devices] of Object.entries(details.details)) {
        if (!Array.isArray(devices) || devices.length === 0) continue;

        devices.forEach((device) => {
            const ip = device.ip_address || "N/A";
            const card = document.querySelector(`[data-ip="${ip}"]`);

            if (!card) return; // If device is not found in UI, skip

            // Ping the device API
            fetch(`${baseUrl}/ping/${ip}`)
                .then(response => response.json())
                .then(statusData => {
                    const newStatus = statusData.status.toLowerCase(); // Get live status
                    const currentStatus = card.dataset.status; // Current status in UI

                    // Update the UI instantly
                    const statusDot = card.querySelector(".status-dot");
                    const statusText = card.querySelector(".device-status");

                    if (newStatus === "online") {
                        statusDot.style.backgroundColor = "green";
                        statusText.textContent = "Online";
                    } else {
                        statusDot.style.backgroundColor = "red";
                        statusText.textContent = "Offline";
                    }

                    if (newStatus !== currentStatus) {
                        statusChanged = true; // A change in status was detected
                        card.dataset.status = newStatus; // Update dataset
                    }
                })
                .catch(error => console.error(`Ping failed for ${ip}:`, error));
        });
    }

    // After processing all devices, if any status changed, refresh summary
    setTimeout(() => {
        if (statusChanged) {
            fetchSummary(regionName);
        }
    }, 5000); // Small delay to ensure all pings are processed
}




setInterval(() => {
    pingAllDevices(details, regionName);
}, 300000); // Every 5 minutes
